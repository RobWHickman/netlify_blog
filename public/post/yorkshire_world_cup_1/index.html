<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.55.6" />
  <meta name="author" content="Robert Hickman">

  
  
  
  
    
      
    
  
  <meta name="description" content="Recently, a Yorkshire national football team appeared in a league of national teams for stateless people. This got me wondering how the historic counties of the UK would do at the world cup. Could any of them compete with full international teams?
This is the complete script for an short article I wrote for CityMetric on the topic. It’s split over 6 separate parts and is pretty hefty but contains pretty much everything you need to clone the article.">

  
  <link rel="alternate" hreflang="en-us" href="/post/yorkshire_world_cup_1/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Robert Hickman">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Robert Hickman">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/yorkshire_world_cup_1/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@robert_squared">
  <meta property="twitter:creator" content="@robert_squared">
  
  <meta property="og:site_name" content="Robert Hickman">
  <meta property="og:url" content="/post/yorkshire_world_cup_1/">
  <meta property="og:title" content="Could an Independent Yorkshire Win the World Cup - Data &amp; Scraping | Robert Hickman">
  <meta property="og:description" content="Recently, a Yorkshire national football team appeared in a league of national teams for stateless people. This got me wondering how the historic counties of the UK would do at the world cup. Could any of them compete with full international teams?
This is the complete script for an short article I wrote for CityMetric on the topic. It’s split over 6 separate parts and is pretty hefty but contains pretty much everything you need to clone the article.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-06-05T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-06-05T00:00:00&#43;00:00">
  

  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<script async type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <title>Could an Independent Yorkshire Win the World Cup - Data &amp; Scraping | Robert Hickman</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Robert Hickman</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#publications_selected">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#writing">
            
            <span>Writing</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">Could an Independent Yorkshire Win the World Cup - Data &amp; Scraping</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-06-05 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Jun 5, 2018
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Robert Hickman">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Could%20an%20Independent%20Yorkshire%20Win%20the%20World%20Cup%20-%20Data%20%26%20Scraping&amp;url=%2fpost%2fyorkshire_world_cup_1%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fyorkshire_world_cup_1%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fyorkshire_world_cup_1%2f&amp;title=Could%20an%20Independent%20Yorkshire%20Win%20the%20World%20Cup%20-%20Data%20%26%20Scraping"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fyorkshire_world_cup_1%2f&amp;title=Could%20an%20Independent%20Yorkshire%20Win%20the%20World%20Cup%20-%20Data%20%26%20Scraping"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Could%20an%20Independent%20Yorkshire%20Win%20the%20World%20Cup%20-%20Data%20%26%20Scraping&amp;body=%2fpost%2fyorkshire_world_cup_1%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


      <div class="article-style" itemprop="articleBody">
        


<p>Recently, a Yorkshire national football team <a href="https://www.theguardian.com/uk-news/2018/jan/28/yorkshire-football-team-makes-debut-in-world-league-of-stateless-peoples">appeared in a league of national teams for stateless people</a>. This got me wondering how the historic counties of the UK would do at the world cup. Could any of them compete with full international teams?</p>
<p>This is the complete script for an short article I wrote for <a href="https://www.citymetric.com/horizons/football-could-independent-yorkshire-win-world-cup-3961">CityMetric</a> on the topic. It’s split over 6 separate parts and is pretty hefty but contains pretty much everything you need to clone the article.</p>
<p>To start, there are 95 historic counts of Great Britain + the 6 counties of Northern Ireland which I included for completeness. These are of a wide variety of sizes and <a href="https://www.citymetric.com/horizons/which-historic-english-county-has-highest-population-3386">approximate population</a> and demographic, so it’s not clear how each would do simply from inspection.</p>
<p>The data for this comes from <a href="https://www.ordnancesurvey.co.uk/business-and-government/products/boundary-line.html">Boundary Line</a> and the <a href="https://www.opendatani.gov.uk/dataset?q=boundary">Northern Irish Boundary Database</a>, I’ve put them together already, but its simple enough to do it in sf.</p>
<pre class="r"><code>library(dplyr)
library(rvest)
library(data.table)
library(ggplot2)</code></pre>
<pre class="r"><code>p &lt;- ggplot(data = uk_counties) +
  geom_sf() +
  theme_void()

plot(p)</code></pre>
<p><img src="/post/2018-06-07-yorkshire_world_cup_1_files/figure-html/historic_counties-1.png" width="672" /></p>
<p>In order to calculate how good each county team would be, I needed a measure of the ability of all of the players they could field. For this I turned to the FIFA18 video game which rates players along a variety of scales.</p>
<div id="scrape-player-data" class="section level1">
<h1>Scrape Player Data</h1>
<p>To get data on every player in the game I wrote a quick scraping function. This finds the links to every player on all 602 pages of <a href="https://www.fifaindex.com/players/" class="uri">https://www.fifaindex.com/players/</a> and then downloads all the data required on each player.</p>
<pre class="r"><code>#both steps here take a fair amount of time
#about 10mins and an hour respectively

#get the links to each players page
all_player_links &lt;- unlist(lapply(paste0(&quot;https://www.fifaindex.com/players/&quot;, 1:602), function(x) {
  player_link &lt;- read_html(x) %&gt;%
    html_nodes(&quot;td:nth-child(4) a&quot;) %&gt;%
    html_attr(&quot;href&quot;)
  })) %&gt;%
  paste0(&quot;https://www.fifaindex.com/&quot;, .)

#big function to scrape every piece of data we could want of each players page
get_player_data &lt;- function(link) {
  #read the players web page
  read &lt;- read_html(link)
  
  #basic data
  name &lt;- read %&gt;%html_nodes(&quot;.big&quot;) %&gt;% html_text()
  club &lt;- read %&gt;% html_nodes(&quot;.panel-title a+ a&quot;) %&gt;% html_text() %&gt;% .[length(.)]
  if(length(club) == 0) {
    club &lt;- NA
  }
  nationality &lt;- read %&gt;% html_nodes(&quot;.subtitle a&quot;) %&gt;% html_text()
  
  #general info on the player
  height &lt;- read %&gt;% html_nodes(&quot;.col-lg-5 p:nth-child(1) .pull-right&quot;) %&gt;% html_text() %&gt;%
    gsub(&quot; cm&quot;, &quot;&quot;, .) %&gt;% as.numeric()
  weight &lt;- read %&gt;% html_nodes(&quot;.col-lg-5 p:nth-child(2) .pull-right&quot;) %&gt;% html_text() %&gt;%
    gsub(&quot; kg&quot;, &quot;&quot;, .) %&gt;% as.numeric()
  foot &lt;- read %&gt;% html_nodes(&quot;.col-lg-5 p:nth-child(3) .pull-right&quot;) %&gt;% html_text()
  birthdate &lt;- read %&gt;% html_nodes(&quot;.col-lg-5 p:nth-child(4) .pull-right&quot;) %&gt;% html_text() %&gt;%
    as.Date(&quot;%m/%d/%Y&quot;)
  age &lt;- read %&gt;% html_nodes(&quot;.col-lg-5 p:nth-child(5) .pull-right&quot;) %&gt;% html_text() %&gt;%
    as.numeric()
  main_position &lt;- read %&gt;% html_nodes(&quot;body &gt; div.container.main &gt; div:nth-child(3) &gt; div.col-md-8 &gt; div:nth-child(3) &gt; div.col-lg-5.col-sm-6 &gt; div &gt; div.panel-body &gt; p:nth-child(6) &gt; span &gt; a&quot;) %&gt;% 
    .[1] %&gt;% html_attr(&quot;title&quot;)
  work_rate &lt;- read %&gt;% html_nodes(&quot;.col-lg-5 p:nth-child(7) .pull-right&quot;) %&gt;% html_text() %&gt;% 
    str_split(., &quot; / &quot;) %&gt;% unlist()
  
  #the players rating for each skill
  ratings &lt;- read %&gt;% html_nodes(&quot;.rating&quot;) %&gt;% html_text() %&gt;% as.numeric() %&gt;%
    as.matrix() %&gt;% t() %&gt;% as.data.frame()
  names(ratings) &lt;- c(&quot;overall&quot;,&quot;specific&quot;,&quot;ball_control&quot;,&quot;dribbling&quot;,&quot;marking&quot;,&quot;slide_tackle&quot;,&quot;stand_tackle&quot;,
                      &quot;aggression&quot;,&quot;reactions&quot;,&quot;positioning&quot;,&quot;interceptions&quot;,&quot;vision&quot;,&quot;composure&quot;,&quot;crossing&quot;,
                      &quot;short_pass&quot;,&quot;long_pass&quot;,&quot;acceleration&quot;,&quot;stamina&quot;,&quot;strength&quot;,&quot;balance&quot;,&quot;sprint_speed&quot;,
                      &quot;agility&quot;,&quot;jumping&quot;,&quot;heading&quot;,&quot;shot_power&quot;,&quot;finishing&quot;,&quot;long_shots&quot;,&quot;curve&quot;,&quot;free_kicks&quot;,
                      &quot;penalties&quot;,&quot;volleys&quot;,&quot;gk_positioning&quot;,&quot;gk_diving&quot;,&quot;gk_handling&quot;,&quot;gk_kicking&quot;,&quot;gk_reflexes&quot;)
  
  #stick everything into a dataframe to be output
  df &lt;- data.frame(name = name, club = club, nationality = nationality,
                   height = height, weight = weight, foot = foot, birthdate = birthdate, age = age,
                   main_position = main_position, work_rate1 = work_rate[1], work_rate2 = work_rate[2]) %&gt;%
    cbind(ratings)
  return(df)
}

#scrape the info on all players
all_players_data &lt;- rbindlist(lapply(all_player_links, get_player_data)) %&gt;%
  setDT() %&gt;%
  #add an id column for each player
  .[, id := 1:.N]</code></pre>
<p>Once that’s scraped and bound we can take a peek at the data. There’s 18k players in total and 48 variables for each so we’ll just look at a few for now.</p>
<pre class="r"><code>#show a selection of the some key info for each player
#the id we gave them, their name, nationality, and their overall ability
head(select(all_players_data, id, name, nationality, overall))</code></pre>
<pre><code>##    id              name nationality overall
## 1:  1      Lionel Messi   Argentina      94
## 2:  2 Cristiano Ronaldo    Portugal      94
## 3:  3            Neymar      Brazil      92
## 4:  4       Luis Suárez     Uruguay      92
## 5:  5      Manuel Neuer     Germany      92
## 6:  6            De Gea       Spain      91</code></pre>
<p>Over the course of the next posts, we’ll use this data to calculate a player’s ability in any position on the field. This will then be used to select optimal teams for each nation (or each historic British county). Finally we’ll take the average ability of these optimal teams and use them to simulate the World Cup to get the chance each team has to win the tournament.</p>
</div>

      </div>

      


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/rstats">rstats</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/world-cup">world cup</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/football">football</a>
  
</div>



    </div>
  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/post/riddler-27th-april-2018/">Riddler 27th April 2018</a></li>
    
    <li><a href="/post/hello-world-a-small-chess-plotting-package/">Hello World! And A Small Chess Plotting Package</a></li>
    
  </ul>
</div>




<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

