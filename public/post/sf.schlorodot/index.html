<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.32.2" />
  <meta name="author" content="Robert Hickman">

  
  
  
  
    
      
    
  
  <meta name="description" content="Recently, I’d seen two tweets with stunning examples of maps by Paul Campbell here and (taken inspiration from the first) by Imer Muhović here.
The basic idea of the dot chloropleths is to visualise not only the location clustering of each variable but the number of observations (something traditional ‘filled’ chloropleths don’t do). More importantly than this, the maps also just look really really cool.
I had a spare few minutes during work on Friday which I tidied up into a package to calculate the random position of dots for such maps which can be found on my github.">

  
  <link rel="alternate" hreflang="en-us" href="/post/sf.schlorodot/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Robert Hickman">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Robert Hickman">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/sf.schlorodot/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@robert_squared">
  <meta property="twitter:creator" content="@robert_squared">
  
  <meta property="og:site_name" content="Robert Hickman">
  <meta property="og:url" content="/post/sf.schlorodot/">
  <meta property="og:title" content="sf.chlorodot mini-package | Robert Hickman">
  <meta property="og:description" content="Recently, I’d seen two tweets with stunning examples of maps by Paul Campbell here and (taken inspiration from the first) by Imer Muhović here.
The basic idea of the dot chloropleths is to visualise not only the location clustering of each variable but the number of observations (something traditional ‘filled’ chloropleths don’t do). More importantly than this, the maps also just look really really cool.
I had a spare few minutes during work on Friday which I tidied up into a package to calculate the random position of dots for such maps which can be found on my github.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-09-09T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-09-09T00:00:00&#43;00:00">
  

  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<script async type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <title>sf.chlorodot mini-package | Robert Hickman</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Robert Hickman</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#publications_selected">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#writing">
            
            <span>Writing</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">sf.chlorodot mini-package</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-09-09 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Sep 9, 2018
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Robert Hickman">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=sf.chlorodot%20mini-package&amp;url=%2fpost%2fsf.schlorodot%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fsf.schlorodot%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fsf.schlorodot%2f&amp;title=sf.chlorodot%20mini-package"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fsf.schlorodot%2f&amp;title=sf.chlorodot%20mini-package"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=sf.chlorodot%20mini-package&amp;body=%2fpost%2fsf.schlorodot%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


      <div class="article-style" itemprop="articleBody">
        <p>Recently, I’d seen two tweets with stunning examples of maps by Paul Campbell <a href="https://twitter.com/PaulCampbell91/status/992043182996193280">here</a> and (taken inspiration from the first) by Imer Muhović <a href="https://twitter.com/ImerM1/status/1037358973807210498">here</a>.</p>
<p>The basic idea of the dot chloropleths is to visualise not only the location clustering of each variable but the number of observations (something traditional ‘filled’ chloropleths don’t do). More importantly than this, the maps also just look really really cool.</p>
<p>I had a spare few minutes during work on Friday which I tidied up into a package to calculate the random position of dots for such maps which can be found <a href="https://github.com/RobWHickman/sf.chlorodot">on my github</a>.</p>
<p>Below, I’ll outline the code for the South African example used in the package README. Data comes from Adrian Frith’s <a href="https://census2011.adrianfrith.com/">very good 2011 census site</a> and <a href="https://gadm.org/download_country_v3.html">gadm</a> for the shapefiles.</p>
<pre class="r"><code>library(sf)
library(ggplot2)
library(tidyverse)
library(data.table)
library(rvest)

devtools::install_github(&#39;RobWHickman/sf.chlorodot&#39;)
library(sf.chlordot)</code></pre>
<p>Next, download and scrape the data for the map</p>
<pre class="r"><code>#download the South African shapefile fom gadm
admin_url &lt;- &quot;https://biogeo.ucdavis.edu/data/gadm3.6/Rsf/gadm36_ZAF_3_sf.rds&quot;
download.file(admin_url, destfile = &quot;shapefiles.rds&quot;, mode = &quot;wb&quot;)
south_africa &lt;- readRDS(&quot;shapefiles.rds&quot;) %&gt;%
  #convert to sf
  st_as_sf() %&gt;%
  select(region = NAME_3) %&gt;%
  #merge geometries that have two rows
  group_by(region) %&gt;%
  summarise()

#get the links to the data from Adrian Frith&#39;s site
sa_data_url &lt;- &quot;https://census2011.adrianfrith.com&quot;
south_africa_data &lt;- sa_data_url %&gt;%
  read_html() %&gt;% html_nodes(&quot;.namecell a&quot;) %&gt;% html_attr(&quot;href&quot;) %&gt;% paste0(sa_data_url, .) %&gt;%
  lapply(., function(x) read_html(x) %&gt;% html_nodes(&quot;.namecell a&quot;) %&gt;% html_attr(&quot;href&quot;) %&gt;% paste0(sa_data_url, .)) %&gt;% unlist() %&gt;%
   lapply(., function(x) read_html(x) %&gt;% html_nodes(&quot;.namecell a&quot;) %&gt;% html_attr(&quot;href&quot;) %&gt;% paste0(sa_data_url, .)) %&gt;% unlist()

#scrape the data on primary language from the 2011 South African census
language_data &lt;- rbindlist(lapply(south_africa_data, function(x) {
  read &lt;- read_html(x)
  language_nos &lt;- read %&gt;% html_nodes(&quot;.datacell&quot;) %&gt;% html_text()
  start &lt;- grep(&quot;Percentage&quot;, language_nos)[3] + 1
  stop &lt;- grep(&quot;Population&quot;, language_nos) - 1
  #some areas have no data
  if(!is.na(start) &amp; !is.na(stop)) {
    language_nos &lt;- language_nos[start:stop]
    language_nos &lt;- language_nos[seq(1, length(language_nos), 2)]
  } else {
    language_nos &lt;- NA
  }
  
  languages &lt;- read %&gt;% html_nodes(&quot;tr &gt; :nth-child(1)&quot;) %&gt;% html_text()
  start &lt;- grep(&quot;First language&quot;, languages) + 1
  stop &lt;- grep(&quot;Name&quot;, languages) - 1
  if(length(start) &gt; 0 &amp; !is.na(stop)) {
    languages &lt;- languages[start:stop]
  } else {
    languages &lt;- NA
  }
  
  region_names &lt;- read %&gt;% html_nodes(&quot;.topname&quot;) %&gt;% html_text()
  
  #combine into a df
  df &lt;- data.frame(language = languages, primary_speakers = language_nos, region = region_names)
  return(df)
}))</code></pre>
<p>the lanaguage data then needs to be transformed before the dot position is calculated. It must be in ‘short’ format with variables as column names. At the same time we can do some cleaning in order to match the shape areas with the region names from the census and remove data we don’t want to plot</p>
<pre class="r"><code>language_data %&lt;&gt;%
  #convert number of speakers to numeric
  mutate(primary_speakers = as.numeric(as.character(primary_speakers))) %&gt;%
  #matching of area names with South African shapefile
  mutate(region = gsub(&quot; NU&quot;, &quot;&quot;, region)) %&gt;%
  mutate(region = gsub(&quot;Tshwane&quot;, &quot;City of Tshwane&quot;, region)) %&gt;%
  #filter only the data we want to merge
  filter(region %in% south_africa$region) %&gt;%
  filter(!is.na(language)) %&gt;%
  filter(language != &quot;Not applicable&quot;) %&gt;%
  #spread the data
  dcast(., region ~ language, value.var = &quot;primary_speakers&quot;, fun.aggregate = sum) %&gt;%
  #join in the spatial geometry
  left_join(., south_africa) %&gt;%
  #convert to sf
  st_as_sf()</code></pre>
<p>then we can calculate the random dot position using calc_dots() from the sf.chlorodot package. This takes three arguments. The first is the df to take the data from (language_data). The second is which variables to calculate positions for. The easiest way to do this is to use names(df) and select from there, though a character vector can also be passed. Finally, n_per_dot is the number of observations (speakers of language x) for each dot on the map. This will affect the look of the map, but also the processing time (lower n_per_dot = greater time) so play around with it a bit.</p>
<pre class="r"><code>#calculate the dot positions using calc_dots from the sf.chlorodot package
sf_dots &lt;- calc_dots(df = language_data, col_names = names(language_data)[2:14], n_per_dot = 1000)</code></pre>
<p>Finally, we can plot the output of this</p>
<pre class="r"><code>#stolen the background colour scheme from Paul Campbell&#39;s blog
#original inspiration for this package
p &lt;- ggplot() +
  geom_sf(data = south_africa, fill = &quot;transparent&quot;,colour = &quot;white&quot;) +
  geom_point(data = sf_dots, aes(lon, lat, colour = variable), size = 0.1) +
  scale_colour_discrete(name = &quot;Primary Language&quot;) +
  ggtitle(&quot;Language Diversity in South Africa&quot;) +
  theme_void() +
  guides(colour = guide_legend(override.aes = list(size = 10))) +
  theme(plot.background = element_rect(fill = &quot;#212121&quot;, color = NA), 
        panel.background = element_rect(fill = &quot;#212121&quot;, color = NA),
        legend.background = element_rect(fill = &quot;#212121&quot;, color = NA),
        text =  element_text(color = &quot;white&quot;),
        title =  element_text(color = &quot;white&quot;),
        legend.text=element_text(size=12),
        plot.title = element_text(size = 20),
        plot.margin = margin(1, 1, 1, 1, &quot;cm&quot;))</code></pre>
<p><img src="../../img/south_africa.png" alt="chlorodot map of South African languages" /></p>
<p>Enjoy!</p>

      </div>

      


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/maps">maps</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/package">package</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/sf">sf</a>
  
</div>



    </div>
  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/post/riddler-27th-april-2018/">Riddler 27th April 2018</a></li>
    
    <li><a href="/post/hello-world-a-small-chess-plotting-package/">Hello World! And A Small Chess Plotting Package</a></li>
    
  </ul>
</div>




<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

