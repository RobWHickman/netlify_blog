<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.54.0" />
  <meta name="author" content="Robert Hickman">

  
  
  
  
    
      
    
  
  <meta name="description" content="I wrote this one pretty quickly compared to part 1 (which goes much deeper into mathematical concepts), and only realized after how much of a similarity it has to many of Ben Torvaney’s posts on the subject. This probably isn’t a coincidence given how much I’ve used his work previously in posts on this blog. Any imitation here is meant as flattery. The purpose of this post is really as a bridge between what I really want to write about- the maths behind the models in part 1, and extensions of these models into other distribution in parts 3-n so it might be a little derivative of stuff written elsewhere.">

  
  <link rel="alternate" hreflang="en-us" href="/post/dixon_coles_2/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Robert Hickman">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Robert Hickman">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/dixon_coles_2/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@robert_squared">
  <meta property="twitter:creator" content="@robert_squared">
  
  <meta property="og:site_name" content="Robert Hickman">
  <meta property="og:url" content="/post/dixon_coles_2/">
  <meta property="og:title" content="An Introduction to Modelling Soccer Matches in R (part 2) | Robert Hickman">
  <meta property="og:description" content="I wrote this one pretty quickly compared to part 1 (which goes much deeper into mathematical concepts), and only realized after how much of a similarity it has to many of Ben Torvaney’s posts on the subject. This probably isn’t a coincidence given how much I’ve used his work previously in posts on this blog. Any imitation here is meant as flattery. The purpose of this post is really as a bridge between what I really want to write about- the maths behind the models in part 1, and extensions of these models into other distribution in parts 3-n so it might be a little derivative of stuff written elsewhere.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-04-26T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2020-04-26T00:00:00&#43;00:00">
  

  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<script async type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <title>An Introduction to Modelling Soccer Matches in R (part 2) | Robert Hickman</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Robert Hickman</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#publications_selected">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/files/cv/cv.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">An Introduction to Modelling Soccer Matches in R (part 2)</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2020-04-26 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Apr 26, 2020
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Robert Hickman">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    24 min read
  </span>
  

  
  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=An%20Introduction%20to%20Modelling%20Soccer%20Matches%20in%20R%20%28part%202%29&amp;url=%2fpost%2fdixon_coles_2%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fdixon_coles_2%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fdixon_coles_2%2f&amp;title=An%20Introduction%20to%20Modelling%20Soccer%20Matches%20in%20R%20%28part%202%29"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fdixon_coles_2%2f&amp;title=An%20Introduction%20to%20Modelling%20Soccer%20Matches%20in%20R%20%28part%202%29"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=An%20Introduction%20to%20Modelling%20Soccer%20Matches%20in%20R%20%28part%202%29&amp;body=%2fpost%2fdixon_coles_2%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


      <div class="article-style" itemprop="articleBody">
        


<p><em>I wrote this one pretty quickly compared to part 1 (which goes much deeper into mathematical concepts), and only realized after how much of a similarity it has to many of <a href="https://twitter.com/Torvaney?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">Ben Torvaney’s</a> posts on the subject. This probably isn’t a coincidence given how much I’ve used his work previously in posts on this blog. Any imitation here is meant as flattery. The purpose of this post is really as a bridge between what I really want to write about- the maths behind the models in part 1, and extensions of these models into other distribution in parts 3-n so it might be a little derivative of stuff written elsewhere.</em></p>
<p>On this blog I enjoy explaining various concepts from the more academic side of football analytics. One of my favourite results from this field are the papers in predicting future soccer matches based on limited information about past matches. Roughly 1 year ago I published <a href="https://www.robert-hickman.eu/post/dixon_coles_1/">part 1</a> on a series of this and never got round to writing part 2 (of hopefully 2 or 3 more).</p>
<p>In the first post, we saw how we can use the Poisson distribution to estimate the relative strengths of teams in a hypothetical summer league between Arsenal, Blackburn Rovers, Coventry City, Dover Athletic, Enfield Town, and Frimley Green. Now we want to move onto actually <em>using</em> these estimates to predict matches, and eventually, whole leagues.</p>
<p>A good way to sum up this post in one line is a quote (mis) attributed to Niels Bohr:</p>
<div id="its-difficult-to-make-predictions-especially-about-the-future" class="section level3">
<h3><em>“It’s Difficult to Make Predictions, Especially About the Future”</em></h3>
<p>We’ve made our predictions about the past (estimating the relative strengths of teams based on past results), now we need to predict the future. I think it also nicely captures that even our predictions about the past are noisy- we can not ever truly know the exact strengths of football teams; the job of analytics is to estimate these are accurately as possible. But any noise in those past predictions will be carried forward and amplified when predicting the future.</p>
<p>Onward to the code, first as always, loading libraries and setting a seed for reproducibility:</p>
<pre class="r"><code>library(tidyverse)
library(ggrepel)

set.seed(3459)</code></pre>
<p>We’re then going to load all the stuff we prepped and predicted in the last post. Remember the α parameter below refers to a teams attacking strength (the relative number of goals they are expected to score), and the β parameter refers to the attacking strength (the inverse of the relative number of goals they are expected to concede). Finally, γ refers to the extra advantage of playing at home.</p>
<p>(all these files are on the github repo for this site)</p>
<pre class="r"><code>fixtures &lt;- readRDS(&quot;../../static/files/dc_2/dc_fixtures.rds&quot;)
results &lt;- readRDS(&quot;../../static/files/dc_2/dc_results.rds&quot;)

model &lt;- readRDS(&quot;../../static/files/dc_2/dc_model.rds&quot;)

model</code></pre>
<pre><code>## $alpha
##          Arsenal Blackburn_Rovers    Coventry_City   Dover_Athletic 
##        1.1106558        0.6370160        0.3023048       -0.2875353 
##     Enfield_Town    Frimley_Green 
##       -0.3767038       -1.3857376 
## 
## $beta
##          Arsenal Blackburn_Rovers    Coventry_City   Dover_Athletic 
##        0.6457175        0.4289270        0.3647815       -0.1362931 
##     Enfield_Town    Frimley_Green 
##       -0.3852812       -0.9178517 
## 
## $gamma
##    gamma 
## 0.189462</code></pre>
<p>We’ll define a quick function to do our prediction. For a quick explanation of exactly why it’s coded as presented, see <a href="https://www.robert-hickman.eu/post/dixon_coles_1/#Tinkering">the previous post</a>, under the title ‘Tinkering’.</p>
<p>For a given string of a home team and an away team, the function finds the relevant parameters from a third argument (param_list) and calculates the expected goal for each team.</p>
<pre class="r"><code>predict_results &lt;- function(home, away, param_list) {
  e_goals_home &lt;- exp(param_list$alpha[home] - param_list$beta[away] + param_list$gamma)
  e_goals_away &lt;- exp(param_list$alpha[away] - param_list$beta[home])
  
  df &lt;- data.frame(home = home, away = away,
                   e_hgoal = as.numeric(e_goals_home), 
                   e_agoal = as.numeric(e_goals_away))
  
  return(df)
}</code></pre>
<p>If we run this for two example teams for example:</p>
<pre class="r"><code>#two example teams
home &lt;- &quot;Blackburn_Rovers&quot;
away &lt;- &quot;Arsenal&quot;

prediction &lt;- predict_results(home, away, model) 
prediction</code></pre>
<pre><code>##               home    away  e_hgoal  e_agoal
## 1 Blackburn_Rovers Arsenal 1.198128 1.977293</code></pre>
<p>We can see that it gives Arsenal (the away team) a slightly more optimistic chance than Blackburn. The expected goals for each team of course can be rewritten as the mean, and in our Poisson model refers to λ (lambda)- the mean times an event (goal) happens per a time interval (match). We also set a maximum number of possible goals (7 in this case*) to bound the area under the distribution so we aren’t sampling forever.</p>
<p>*sharp readers might notice that this is actually <em>lower</em> than the lambda for our more extreme cases (e.g. Arsenal at home to Frimley Green), but for realistic matches (even between wildly different professional sides) this is a fair enough assumption.</p>
<p>We then use dpois() to calculate the probability of this Poisson function returning a value (0:7 goals) given it’s lambda value. So if we run this over the prediction we made for Blackburn Rovers vs. Arsenal we get:</p>
<pre class="r"><code>#set a limit of where we&#39;ll calculate across
max_goals &lt;- 7

#calculate the probability of scoring x goals for either team
blackburn_goal_probs &lt;- lapply(0:max_goals, dpois, lambda = prediction$e_hgoal)
arsenal_goal_probs &lt;- lapply(0:max_goals, dpois, lambda = prediction$e_agoal)

#bind together in a df
df &lt;- data.frame(goals = rep(0:max_goals, 2),
                 team = rep(c(home, away), each = max_goals+1),
                 p = c(unlist(blackburn_goal_probs), unlist(arsenal_goal_probs)))

#plot the p of scoring x goals for either team
p1 &lt;- ggplot(df, aes(x = goals, y = p, fill = team)) +
  geom_density(stat = &quot;identity&quot;, alpha = 0.5) +
  scale_fill_manual(values = c(&quot;red&quot;, &quot;blue&quot;)) +
  labs(title = &quot;Predicted goals for Blackburn Rovers and Arsenal&quot;,
       y = &quot;probability&quot;) +
  theme_minimal()

p1</code></pre>
<p><img src="/post/2019-30-5-dixon-coles-2_files/figure-html/predict_mach_goals-1.png" width="672" /></p>
<p>Because of how maths works, these curves are the same result we would get if we ran rpois() (sampling from the Poisson function) lots of times. We’ll do that quickly because it sets the stage nicely for what will come later.</p>
<pre class="r"><code>#sample from the function lots of times for each team
n &lt;- 100000
blackburn_goals_samples &lt;- rpois(n, lambda = prediction$e_hgoal)
arsenal_goals_samples &lt;- rpois(n, lambda = prediction$e_agoal)

df &lt;- data.frame(team = rep(c(home, away), each = n),
                 sampled_goals = c(blackburn_goals_samples, arsenal_goals_samples))

#look its the same plot!
p2 &lt;- ggplot(df, aes(x = sampled_goals, fill = team)) +
  geom_bar(stat = &quot;count&quot;, position = &quot;dodge&quot;, colour = &quot;black&quot;, alpha = 0.5) +
  geom_line(aes(colour = team), stat = &quot;count&quot;, size = 3) +
  scale_fill_manual(values = c(&quot;red&quot;, &quot;blue&quot;), guide = FALSE) +
  scale_colour_manual(values = c(&quot;red&quot;, &quot;blue&quot;), guide = FALSE) +
  labs(title = &quot;Predicted goals for Blackburn Rovers and Arsenal&quot;,
       y = &quot;probability&quot;,
       x = &quot;sampled goals&quot;) +
  theme_minimal() +
  theme(axis.text.y = element_blank())

p2</code></pre>
<p><img src="/post/2019-30-5-dixon-coles-2_files/figure-html/monte_carlo_poisson-1.png" width="672" /></p>
<p>Ok great!, in terms of predicting the result, the rightwards shift of the red (Arsenal) curve here is the difference in the teams ability to generate a positive goal differential- it makes it more likely that if we sample event, Arsenal will have scored more goals than Blackburn Rovers at the end of the match. Of course, it’s also obvious that while Arsenal’s curve is right shifted, the bars for Arsenal scoring 0 goals and Blackburn scoring 6 are still sizable enough that it isn’t outside the realm of possibility.</p>
<p>This is a nice way of presenting the chance of each team scoring n goals, but doesn’t really help us in predicting the result of a match given that this relies on the interaction of both these distributions (we need to know how many goals BOTH Arsenal AND Blackburn will score).</p>
<p>To calculate this, we can do an outer product of the probabilities for both teams scoring n goals. We can then plot the probability of each <em>scoreline</em> as a tile plot:</p>
<pre class="r"><code>#calculate matrix of possible results and probabilities of those
matrix &lt;- outer(unlist(arsenal_goal_probs), unlist(blackburn_goal_probs)) %&gt;%
  as.data.frame() %&gt;%
  gather() %&gt;%
  #add in scorelines
  mutate(hgoals = rep(0:max_goals, max_goals+1),
         agoals = rep(0:max_goals, each = max_goals+1))

#make the tile plot
p3 &lt;- ggplot(matrix, aes(x = hgoals, y = agoals, fill = value)) +
  geom_tile() +
  geom_text(aes(label = paste(hgoals, agoals, sep = &quot;-&quot;))) +
  scale_fill_gradient2(low = &quot;white&quot;, high = &quot;red&quot;, guide = FALSE) +
  theme_minimal()

p3</code></pre>
<p><img src="/post/2019-30-5-dixon-coles-2_files/figure-html/example_tileplot-1.png" width="672" /></p>
<p>Where we can see that the most common scorelines are low scoring (football is a low scoring game), and slightly biased towards away goals (i.e. Arsenal are more likely to win than lose). The darkest (most likely) tiles being 1-1 or a 2-1 Arsenal win seem very plausible given our calculated λs earlier.</p>
<p>We can then do this for every fixture and build a large graph of the expected results for each using a simple map2_ apply. Because of the huge plot, I’ve restricted it here to a 3x3 matrix of the results for Arsenal, Coventry City, and Enfield Town, but if you click you should be linked to the full image.</p>
<pre class="r"><code>#want to predict over the whole fixture space
all_fixtures &lt;- bind_rows(fixtures, results) %&gt;%
  filter(!duplicated(paste(home, away), fromLast = TRUE))

#get the lambda for each team per game
predictions &lt;- map2_df(all_fixtures$home, all_fixtures$away, 
                       predict_results,
                       model)

#calc out probabilities and bind up
all_predictions &lt;- map2_df(
  predictions$e_hgoal, predictions$e_agoal, 
  function(lambda_home, lambda_away, max_goals) {
    hgoal_prob &lt;- dpois(0:max_goals, lambda_home) %&gt;% `names&lt;-`(0:max_goals)
    agoal_prob &lt;- dpois(0:max_goals, lambda_away) %&gt;% `names&lt;-`(0:max_goals)
    outer(hgoal_prob, agoal_prob) %&gt;%
      as.data.frame() %&gt;% 
      gather() %&gt;% 
      rownames_to_column(&quot;row&quot;) %&gt;%
      mutate(hgoal = as.numeric(row) %% (max_goals+1)-1) %&gt;% 
      mutate(hgoal = case_when(hgoal &lt; 0 ~ max_goals, TRUE ~ hgoal),
             agoal = as.numeric(key)) %&gt;%
      select(sample_hgoal = hgoal, sample_agoal = agoal, prob = value)
}, max_goals) %&gt;%
  cbind(all_fixtures[rep(seq_len(nrow(all_fixtures)), each=(max_goals+1)^2),], .) %&gt;%
  group_by(home, away) %&gt;%
  mutate(prob = prob / sum(prob)) %&gt;%
  ungroup()

#plot again
p3 &lt;- all_predictions %&gt;%
  #filter only a few out to scale plot 
  filter(home %in% c(&quot;Arsenal&quot;, &quot;Coventry_City&quot;, &quot;Enfield_Town&quot;),
         away %in% c(&quot;Arsenal&quot;, &quot;Coventry_City&quot;, &quot;Enfield_Town&quot;)) %&gt;%
  ggplot(aes(x = sample_hgoal, y = sample_agoal, fill = prob)) +
  geom_tile() +
  geom_point(aes(x = hgoal, y = agoal), 
             colour = &quot;blue&quot;, size = 5, alpha = 0.5 / max_goals^2) +
  geom_text(aes(label = paste(sample_hgoal, sample_agoal, sep = &quot;-&quot;)), size = 2.3) +
  scale_fill_gradient2(low = &quot;white&quot;, high = &quot;red&quot;, guide = FALSE) +
  labs(
    title = &quot;predictions for final score across all fixtures&quot;,
    y = &quot;away goals&quot;,
    x = &quot;home goals&quot;) +
  theme_minimal() +
  facet_grid(away~home, scales = &quot;free&quot;)

p3</code></pre>
<p><img src="/post/2019-30-5-dixon-coles-2_files/figure-html/plot_all_matrix-1.png" width="672" /></p>
<p>For the whole matrix, click <a href="https://www.robert-hickman.eu/img/results_matrix.png">here</a></p>
</div>
<div id="so-what" class="section level2">
<h2>So what?</h2>
<p>These graphs are nice, but whats important is what they show: <em>we have a way to quantify how likely any result is in a match between two given teams</em>. Why is this useful</p>
<ul>
<li>Firstly, we can use the output of this to build betting models. Given the odds on final scores for any match, we can hedge effectively by betting on (e.g.) the five overwhelmingly most likely results.</li>
<li>Secondly, we can simulate leagues. This is <a href="https://www.bloomberg.com/graphics/2020-coronavirus-european-football/">perhaps especially of interest given the context of writing this post</a>. I’m going to focus on this application because I don’t bet on football, and also because it’s hard to get a nice database of odds at the moment given the aforementioned situation.</li>
</ul>
<p><a href="https://www.youtube.com/watch?v=DYb8gS-wDrM">The Verve - Monte Carlo</a></p>
<p>We can do this using a technique called <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Monte Carlo simulation</a>. There are lots of good explanation of the technique on the internet, but it basically boils down to this:</p>
<div id="if-events-follow-a-known-distribution-you-can-sample-these-events-lots-of-times-to-get-stochastic-guesstimates-but-over-many-samples-you-will-reproduce-exactly-that-distribution" class="section level3">
<h3>"if events follow a known distribution*, you can sample these events lots of times to get stochastic guesstimates, but over many samples you will reproduce exactly that distribution"</h3>
<p>*a Poisson distribution for the expected number of goals scored in our case</p>
<p>For football, this means that while on an individual match level results are noisy (sometimes better teams lose!), if we simulate matches lots and lots of times, eventually they should converge to the ‘truth’*</p>
<p>*as defined by our Poisson distribution (which may or may not be a good/accurate ‘truth’ but go with it for now).</p>
<p>To work with this highly repetitive data, first we want to ‘nest’ the probabilities for each match. This basically means storing a df of all the possible results and their probabilities as a column inside a larger df so we can move between the data in those two structures easier.</p>
<p>For instance, the nest match results probability information for the next match to be played (Coventry City and home to Arsenal):</p>
<pre class="r"><code>nested_probabilities &lt;- all_predictions %&gt;%
  filter(is.na(hgoal)) %&gt;%
  select(-hgoal, -agoal) %&gt;%
  nest(probabilities = c(sample_hgoal, sample_agoal, prob))

nested_probabilities$probabilities[[1]] %&gt;%
  rename(&quot;Coventry City&quot; = sample_hgoal, &quot;Arsenal&quot; = sample_agoal) %&gt;%
  arrange(-prob) %&gt;%
  #show first 15 rows
  .[1:15,]</code></pre>
<pre><code>## # A tibble: 15 x 3
##    `Coventry City` Arsenal   prob
##              &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1               0       2 0.115 
##  2               0       1 0.109 
##  3               1       2 0.0983
##  4               1       1 0.0933
##  5               0       3 0.0806
##  6               1       3 0.0691
##  7               0       0 0.0516
##  8               1       0 0.0442
##  9               0       4 0.0425
## 10               2       2 0.0422
## 11               2       1 0.0400
## 12               1       4 0.0364
## 13               2       3 0.0296
## 14               2       0 0.0190
## 15               0       5 0.0179</code></pre>
<p>The probability for any single result is small (otherwise match betting would be easy), but the probabilities for a 2-0 and 1-0 Arsenal wins are highest (as we found earlier). Indeed all of the most likely results are within a goal or two for either side of these.</p>
<p>To make sure these probabilities makes sense, we can sum them and see that the results space of 0:max_goals for either side sums to 1</p>
<pre class="r"><code>sum(nested_probabilities$probabilities[[1]]$prob)</code></pre>
<pre><code>## [1] 1</code></pre>
<p>Then we can easily use this data to simulate results. We sample a single row (a ‘result’ of the match) weighted by the probability of it occurring. For instance, when we sample from the Coventry City vs Arsenal match it picks a 3-1 Arsenal away win (not the likeliest result, but not the most unlikely either).</p>
<pre class="r"><code>nested_probabilities$probabilities[[1]] %&gt;%
  rename(&quot;Coventry_City&quot; = sample_hgoal, &quot;Arsenal&quot; = sample_agoal) %&gt;%
  sample_n(1, weight = prob)</code></pre>
<pre><code>## # A tibble: 1 x 3
##   Coventry_City Arsenal   prob
##           &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1             1       3 0.0691</code></pre>
<p>We can of course repeat this across every match and see that the probabilities of the chosen results vary (because we’re randomly sampling we won’t always choose the most likely, or even a likely result), but all are within a reasonable range given the team playing:</p>
<pre class="r"><code>nested_probabilities %&gt;%
    mutate(sampled_result = map(probabilities, sample_n, 1, weight = prob)) %&gt;%
    select(-probabilities) %&gt;%
    unnest(cols = c(sampled_result))</code></pre>
<pre><code>## # A tibble: 6 x 6
##   home             away             gameweek sample_hgoal sample_agoal   prob
##   &lt;chr&gt;            &lt;chr&gt;               &lt;int&gt;        &lt;dbl&gt;        &lt;dbl&gt;  &lt;dbl&gt;
## 1 Coventry_City    Arsenal                 9            0            5 0.0179
## 2 Blackburn_Rovers Dover_Athletic          9            1            1 0.0575
## 3 Frimley_Green    Enfield_Town            9            0            4 0.0418
## 4 Arsenal          Blackburn_Rovers       10            2            1 0.0966
## 5 Coventry_City    Frimley_Green          10            3            0 0.170 
## 6 Dover_Athletic   Enfield_Town           10            2            1 0.0839</code></pre>
<p>But when we are predicting what will happen, we want to find the <em>most likely</em> result. As mentioned earlier, if we sample enough, our average will converge towards this, so we can repeat this sampling technique n times (here I’ve done it 10 times), depending on how much time we want to wait for it to process.</p>
<p>You can see that as we do this many times, the results with the highest probability turn up more than others- as we would expect if we were to (e.g.) actually play Blackburn Rovers vs Arsenal many times.</p>
<pre class="r"><code>rerun(10, nested_probabilities %&gt;%
    filter(home == &quot;Coventry_City&quot; &amp; away == &quot;Arsenal&quot;) %&gt;%
    mutate(sampled_result = map(probabilities, sample_n, 1, weight = prob)) %&gt;%
    select(-probabilities) %&gt;%
    unnest(cols = c(sampled_result))
) %&gt;%
  bind_rows() %&gt;%
  arrange(-prob)</code></pre>
<pre><code>## # A tibble: 10 x 6
##    home          away    gameweek sample_hgoal sample_agoal   prob
##    &lt;chr&gt;         &lt;chr&gt;      &lt;int&gt;        &lt;dbl&gt;        &lt;dbl&gt;  &lt;dbl&gt;
##  1 Coventry_City Arsenal        9            0            2 0.115 
##  2 Coventry_City Arsenal        9            1            2 0.0983
##  3 Coventry_City Arsenal        9            1            1 0.0933
##  4 Coventry_City Arsenal        9            0            3 0.0806
##  5 Coventry_City Arsenal        9            1            3 0.0691
##  6 Coventry_City Arsenal        9            1            0 0.0442
##  7 Coventry_City Arsenal        9            0            4 0.0425
##  8 Coventry_City Arsenal        9            0            4 0.0425
##  9 Coventry_City Arsenal        9            0            4 0.0425
## 10 Coventry_City Arsenal        9            1            5 0.0154</code></pre>
<p>If we do this a few more times per fixture (here 100, for a better estimate I’d advise at least 10000- it should only take a few minutes), we can then start assigning points and goal difference to each team based upon the result we’ve sampled. E.g. if one sample predicts Arsenal to beat Blackburn Rovers 4-0, we assign 3 points to Arsenal and 0 points to Blackburn Rovers for that simulation and +4 and -4 goal difference respectively.</p>
<pre class="r"><code>n &lt;- 100
fixture_sims &lt;- rerun(n, nested_probabilities %&gt;%
    mutate(sampled_result = map(probabilities, sample_n, 1, weight = prob)) %&gt;%
    select(-probabilities) %&gt;%
    unnest(cols = c(sampled_result)) %&gt;%
  select(-gameweek, -prob) %&gt;%
  pivot_longer(c(home, away), names_to = &quot;location&quot;, values_to = &quot;team&quot;) %&gt;%
  mutate(points = case_when(
    location == &quot;home&quot; &amp; sample_hgoal &gt; sample_agoal ~ 3,
    location == &quot;away&quot; &amp; sample_agoal &gt; sample_hgoal ~ 3,
    sample_hgoal == sample_agoal ~ 1,
    TRUE ~ 0
  )) %&gt;%
  mutate(gd = case_when(
    location == &quot;home&quot; ~ sample_hgoal - sample_agoal,
    location == &quot;away&quot; ~ sample_agoal - sample_hgoal
  )))

fixture_sims[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 12 x 6
##    sample_hgoal sample_agoal location team             points    gd
##           &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
##  1            0            0 home     Coventry_City         1     0
##  2            0            0 away     Arsenal               1     0
##  3            4            0 home     Blackburn_Rovers      3     4
##  4            4            0 away     Dover_Athletic        0    -4
##  5            0            0 home     Frimley_Green         1     0
##  6            0            0 away     Enfield_Town          1     0
##  7            3            0 home     Arsenal               3     3
##  8            3            0 away     Blackburn_Rovers      0    -3
##  9            6            1 home     Coventry_City         3     5
## 10            6            1 away     Frimley_Green         0    -5
## 11            1            1 home     Dover_Athletic        1     0
## 12            1            1 away     Enfield_Town          1     0</code></pre>
<p>We can then average the points and goal difference won in these sims across each team and see what teams are predicted to win across their fixtures.</p>
<pre class="r"><code>fixture_sims %&gt;%
  bind_rows() %&gt;%
  group_by(team) %&gt;%
  summarise(av_points = sum(points)/n,
            av_gd = sum(gd) / n)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   team             av_points av_gd
##   &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;
## 1 Arsenal               4.19  2.44
## 2 Blackburn_Rovers      3.16  0.7 
## 3 Coventry_City         3.61  2.42
## 4 Dover_Athletic        2.26 -1.26
## 5 Enfield_Town          2.95  0.23
## 6 Frimley_Green         0.6  -4.53</code></pre>
<p>Where we can see that we expect Arsenal to win 4.19 out of a possible 6 points (with games remaining against Coventry and Blackburn Rovers they are expected to drop points but win at least one and probably draw the other). Coventry City are expected to also do well- probably because their final game is at home to Frimley Green, whereas Blackburn have tougher fixtures away at Arsenal and home to Dover Athletic.</p>
<p>We can then add this to the calculated points teams have <em>already</em> accrued to get a prediction of where teams will end the season position wise:</p>
<pre class="r"><code>table &lt;- results %&gt;%
  pivot_longer(c(home, away), names_to = &quot;location&quot;, values_to = &quot;team&quot;) %&gt;%
  mutate(points = case_when(
    location == &quot;home&quot; &amp; hgoal &gt; agoal ~ 3,
    location == &quot;away&quot; &amp; agoal &gt; hgoal ~ 3,
    hgoal == agoal ~ 1,
    TRUE ~ 0
  )) %&gt;%
  mutate(gd = case_when(
    location == &quot;home&quot; ~ hgoal - agoal,
    location == &quot;away&quot; ~ agoal - hgoal
  )) %&gt;%
  group_by(team) %&gt;%
  summarise(points = sum(points),
            gd = sum(gd))

predicted_finishes &lt;- map_df(fixture_sims, function(simulated_fixtures, table) {
  simulated_fixtures %&gt;%
    select(team, points, gd) %&gt;%
    bind_rows(., table) %&gt;%
    group_by(team) %&gt;%
    summarise(points = sum(points),
              gd = sum(gd)) %&gt;%
    arrange(-points, -gd) %&gt;%
    mutate(predicted_finish = 1:n())
}, table) %&gt;%
  group_by(team, predicted_finish) %&gt;%
  summarise(perc = n() / n)

predicted_finishes</code></pre>
<pre><code>## # A tibble: 10 x 3
## # Groups:   team [6]
##    team             predicted_finish  perc
##    &lt;chr&gt;                       &lt;int&gt; &lt;dbl&gt;
##  1 Arsenal                         1  0.82
##  2 Arsenal                         2  0.18
##  3 Blackburn_Rovers                1  0.18
##  4 Blackburn_Rovers                2  0.82
##  5 Coventry_City                   3  0.97
##  6 Coventry_City                   4  0.03
##  7 Dover_Athletic                  3  0.03
##  8 Dover_Athletic                  4  0.97
##  9 Enfield_Town                    5  1   
## 10 Frimley_Green                   6  1</code></pre>
<p>Which gives Arsenal an 82% chance of finishing champions, with only a 18% chance Blackburn manage to leapfrog them into 1st place. Given there are only 2 matches left with teams designed to have fairly large gulfs in ability, it’s not surprising most of the final positions are nailed on- e.g. Enfield Town finish 5th in every single simulation:</p>
<pre class="r"><code>p4 &lt;- ggplot(predicted_finishes, aes(x = predicted_finish, y = perc, fill = team)) +
  geom_bar(stat = &quot;identity&quot;, colour = &quot;black&quot;) +
  scale_fill_manual(values = c(&quot;red&quot;, &quot;blue&quot;, &quot;skyblue&quot;, &quot;white&quot;, &quot;dodgerblue4&quot;, &quot;blue&quot;)) +
  labs(
    title = &quot;Predicted finish position of teams&quot;,
    subtitle = &quot;with two gameweeks left to play&quot;,
    y = &quot;fraction of finishes&quot;,
    x = &quot;final position&quot;
  ) +
  theme_minimal() +
  facet_wrap(~team)

p4</code></pre>
<p><img src="/post/2019-30-5-dixon-coles-2_files/figure-html/plot_predicted_finishes-1.png" width="672" /></p>
</div>
</div>
<div id="the-real-thing" class="section level2">
<h2>The Real Thing</h2>
<p>We’re now at the stage where we can start to look at real data. One of the motivating forces which drew me back to this putative blog series was the <a href="https://www.theguardian.com/football/blog/2020/apr/25/finishing-premier-league-season-pointless-football">current football situation</a>- with season ending with games left to play.</p>
<p>We can use the knowledge we’ve built up over these last posts to see what we expect to happen in these unplayed games, if they cannot be completed.</p>
<p>To make code more concise, I’ve used Ben Torvaney’s code in his <a href="https://github.com/Torvaney/regista">regista</a> package (he also has some nice usage blogs similar to this post at his <a href="http://www.statsandsnakeoil.com/">blog</a>). The underlying maths is exactly the same as in my previous post though with a few different design choices. If we run the simulations using the code from the previous post we should get exactly the same answer.</p>
<p>The code following is also extremely similar to the final chunks of one of my previous <a href="https://www.robert-hickman.eu/post/five_min_trivia_invincibles/">posts</a> in analysing the current Liverpool team’s achievements.</p>
<pre class="r"><code>library(rvest)
library(regista)</code></pre>
<p>First we need to download the data on the current English Premier League season. Once we have this we can split it into played matches (where we 100% know the result) and unplayed matches which we need to predict the result of. For the basis of the team strength estimates I’ve used the xg created and allowed per game, as I believe these give a better estimate of team strength (indeed Ben Torvaney has a <a href="http://www.statsandsnakeoil.com/2019/01/06/predicting-the-premier-league-with-dixon-coles-and-xg/">nice post on using even the shot-by-shot xg to produce Dixon-Coles models</a>).</p>
<pre class="r"><code>#download the match data from 2019/2020
fixtures_2020 &lt;- &quot;https://fbref.com/en/comps/9/schedule/Premier-League-Fixtures&quot; %&gt;%
  read_html() %&gt;%
  html_nodes(&quot;#sched_ks_3232_1&quot;) %&gt;%
  html_table() %&gt;%
  as.data.frame() %&gt;%
  separate(Score, into = c(&quot;hgoal&quot;, &quot;agoal&quot;), sep = &quot;–&quot;) %&gt;%
  #only care about goals and expected goals
  select(home = Home, away = Away, home_xg = xG, away_xg = xG.1, hgoal, agoal) %&gt;%
  filter(home != &quot;&quot;) %&gt;%
  mutate(home = factor(home), away = factor(away)) %&gt;%
  #round expected goals to nearest integer
  mutate_at(c(&quot;home_xg&quot;, &quot;away_xg&quot;, &quot;hgoal&quot;, &quot;agoal&quot;), .funs = funs(round(as.numeric(.))))

#matches with a known result
#used for modelling
played_matches &lt;- fixtures_2020 %&gt;%
  filter(!is.na(home_xg))

#matches with an unknown result
#used for simulation
unplayed_matches &lt;- fixtures_2020 %&gt;%
  filter(is.na(home_xg)) %&gt;%
  select_if(negate(is.numeric))

#fit the dixon coles model
#use xg per game, not &#39;actual&#39; goals
fit_2020 &lt;- dixoncoles(home_xg, away_xg, home, away, data = played_matches)</code></pre>
<p>To get a look at what the team parameters in a real-life league look like we can extract them from the model and plot them:</p>
<pre class="r"><code>#extract Dixon-Coles team strenth parameters
pars_2020 &lt;- fit_2020$par %&gt;%
  .[grepl(&quot;def_|off_&quot;, names(.))] %&gt;%
  matrix(., ncol = 2) %&gt;%
  as.data.frame() %&gt;%
  rename(attack = V1, defence = V2)
pars_2020$team &lt;- unique(gsub(&quot;def_*|off_*&quot;, &quot;&quot;, names(fit_2020$par)))[1:20]

#plot as before
p5 &lt;- pars_2020 %&gt;%
  mutate(defence = 1 - defence) %&gt;%
  ggplot(aes(x = attack, y = defence, colour = attack + defence, label = team)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_text_repel() +
  scale_colour_continuous(guide = FALSE) +
  labs(title = &quot;Dixon-Coles parameters for the 2019/2020 EPL&quot;,
       x = &quot;attacking strength&quot;,
       y = &quot;defensive strength&quot;) +
  theme_minimal()

p5</code></pre>
<p><img src="/post/2019-30-5-dixon-coles-2_files/figure-html/plot_real_params-1.png" width="672" />
It might surprise some that Manchester City are predicted to be better than Liverpool by this model, but it shouldn’t given the underlying numbers for both teams. Liverpool have run very hot and Manchester City have run very cold this season.</p>
<p>Finally, we can then calculate the current Premier League table, and simulate remaining games to predict where teams will finish the season if the remainder of games were to be played. I’ve chosen 1000 sims just for sake of processing time, but you can scale up and down as desired.</p>
<pre class="r"><code>#calculate the current EPL table
current_epl_table &lt;- played_matches %&gt;%
  select(home, away, hgoal, agoal) %&gt;%
  pivot_longer(c(home, away), names_to = &quot;location&quot;, values_to = &quot;team&quot;) %&gt;%
  mutate(points = case_when(
    location == &quot;home&quot; &amp; hgoal &gt; agoal ~ 3,
    location == &quot;away&quot; &amp; agoal &gt; hgoal ~ 3,
    hgoal == agoal ~ 1,
    TRUE ~ 0
  )) %&gt;%
  mutate(gd = case_when(
    location == &quot;home&quot; ~ hgoal - agoal,
    location == &quot;away&quot; ~ agoal - hgoal
  )) %&gt;%
  group_by(team) %&gt;%
  summarise(points = sum(points),
            gd = sum(gd))

#the number of sims to run
n &lt;- 10000

#simulate remaining matches
fixture_sims_2020 &lt;- rerun(
  n,
  augment.dixoncoles(fit_2020, unplayed_matches, type.predict = &quot;scorelines&quot;) %&gt;%                     
    mutate(sampled_result = map(.scorelines, sample_n, 1, weight = prob)) %&gt;%
    select(-.scorelines) %&gt;%
    unnest(cols = c(sampled_result)) %&gt;%
  pivot_longer(c(home, away), names_to = &quot;location&quot;, values_to = &quot;team&quot;) %&gt;%
  mutate(points = case_when(
    location == &quot;home&quot; &amp; hgoal &gt; agoal ~ 3,
    location == &quot;away&quot; &amp; agoal &gt; hgoal ~ 3,
    hgoal == agoal ~ 1,
    TRUE ~ 0
  )) %&gt;%
  mutate(gd = case_when(
    location == &quot;home&quot; ~ hgoal - agoal,
    location == &quot;away&quot; ~ agoal - hgoal
  )) %&gt;%
    select(team, points, gd))

#calculate final EPL tables
predicted_finishes_2020 &lt;- map_df(fixture_sims_2020, function(sim_fixtures, table) {
  sim_fixtures %&gt;%
    select(team, points, gd) %&gt;%
    bind_rows(., table) %&gt;%
    group_by(team) %&gt;%
    summarise(points = sum(points),
              gd = sum(gd)) %&gt;%
    arrange(-points, -gd) %&gt;%
    mutate(predicted_finish = 1:n())
}, current_epl_table) %&gt;%
  group_by(team, predicted_finish) %&gt;%
  summarise(perc = n() / n) %&gt;%
  group_by(team) %&gt;%
  mutate(mean_finish = mean(predicted_finish)) %&gt;%
  arrange(mean_finish) %&gt;%
  ungroup() %&gt;%
  mutate(team = factor(team, levels = unique(team)))</code></pre>
<p>If we then plot these predicted finishes (ordered by the chance of their highest finish position), we can get an idea of where we expect teams to end the season:</p>
<pre class="r"><code>#list of team colours
team_cols &lt;- c(&quot;red&quot;, &quot;skyblue&quot;, &quot;darkblue&quot;, &quot;darkblue&quot;, &quot;darkred&quot;,
               &quot;orange&quot;, &quot;red&quot;, &quot;white&quot;, &quot;red&quot;, &quot;blue&quot;, &quot;maroon&quot;, 
               &quot;blue&quot;, &quot;white&quot;, &quot;red&quot;, &quot;dodgerblue&quot;, &quot;yellow&quot;, 
               &quot;maroon&quot;, &quot;red&quot;, &quot;maroon&quot;, &quot;yellow&quot;)

#plot the finishing position by chance based on these simualtions
p6 &lt;- ggplot(predicted_finishes_2020, 
             aes(x = predicted_finish, y = perc, fill = team)) +
  geom_bar(stat = &quot;identity&quot;, colour = &quot;black&quot;) +
  scale_fill_manual(values = team_cols, guide = FALSE) +
  labs(
    title = &quot;Predicted finish position of teams&quot;,
    subtitle = &quot;for incomplete 2019/2020 EPL season&quot;,
    y = &quot;fraction of finishes&quot;,
    x = &quot;final position&quot;
  ) +
  theme_minimal() +
  facet_wrap(~team)

p6</code></pre>
<p><img src="/post/2019-30-5-dixon-coles-2_files/figure-html/plot_2020_prediction-1.png" width="672" /></p>
<p>So great news for Liverpool fans who the model believes have a 100% chance of finishing in first place. Leicester also might be happy with a nailed on 3rd place, with Chelsea or Manchester United probably rounding out the top four, and Wolves joining the loser of the two in the Europa League.</p>
<pre class="r"><code>#get the predictions for the 2019/2020 champion
winner &lt;- predicted_finishes_2020 %&gt;%
  filter(predicted_finish &lt; 2)%&gt;%
  mutate(prediction = &quot;Champion chance&quot;)

winner</code></pre>
<pre><code>## # A tibble: 2 x 5
##   team            predicted_finish   perc mean_finish prediction     
##   &lt;fct&gt;                      &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;          
## 1 Liverpool                      1 1.00           1.5 Champion chance
## 2 Manchester City                1 0.0001         2.5 Champion chance</code></pre>
<pre class="r"><code>#get prediction for those who qualify for champions league
#and for europa league
champs_league &lt;- predicted_finishes_2020 %&gt;%
  filter(predicted_finish &lt; 5) %&gt;%
  group_by(team) %&gt;%
  summarise(perc = sum(perc)) %&gt;%
  arrange(-perc) %&gt;%
  mutate(prediction = &quot;Champions League chance&quot;)

champs_league</code></pre>
<pre><code>## # A tibble: 10 x 3
##    team              perc prediction             
##    &lt;fct&gt;            &lt;dbl&gt; &lt;chr&gt;                  
##  1 Liverpool       1      Champions League chance
##  2 Manchester City 1      Champions League chance
##  3 Leicester City  0.933  Champions League chance
##  4 Chelsea         0.479  Champions League chance
##  5 Manchester Utd  0.46   Champions League chance
##  6 Wolves          0.106  Champions League chance
##  7 Sheffield Utd   0.0155 Champions League chance
##  8 Tottenham       0.004  Champions League chance
##  9 Arsenal         0.0018 Champions League chance
## 10 Everton         0.0005 Champions League chance</code></pre>
<pre class="r"><code>europa_league  &lt;- predicted_finishes_2020 %&gt;%
  filter(predicted_finish &lt; 7) %&gt;%
  group_by(team) %&gt;%
  summarise(perc = sum(perc)) %&gt;%
  arrange(-perc) %&gt;%
  mutate(prediction = &quot;(at least) Europa League chance&quot;)

europa_league</code></pre>
<pre><code>## # A tibble: 13 x 3
##    team              perc prediction                     
##    &lt;fct&gt;            &lt;dbl&gt; &lt;chr&gt;                          
##  1 Liverpool       1      (at least) Europa League chance
##  2 Manchester City 1      (at least) Europa League chance
##  3 Leicester City  0.999  (at least) Europa League chance
##  4 Manchester Utd  0.954  (at least) Europa League chance
##  5 Chelsea         0.954  (at least) Europa League chance
##  6 Wolves          0.729  (at least) Europa League chance
##  7 Sheffield Utd   0.196  (at least) Europa League chance
##  8 Tottenham       0.096  (at least) Europa League chance
##  9 Arsenal         0.0479 (at least) Europa League chance
## 10 Everton         0.0139 (at least) Europa League chance
## 11 Burnley         0.0089 (at least) Europa League chance
## 12 Crystal Palace  0.0009 (at least) Europa League chance
## 13 Southampton     0.0008 (at least) Europa League chance</code></pre>
<p>(obviously this model does not account for any ramifications of <a href="https://www.itv.com/news/2020-02-14/manchester-city-banned-from-champions-league-for-two-years-by-uefa/">Manchester City’s European ban</a>)</p>
<p>At the foot of the table, the model is fairly bullish on Norwich being relegated, with Aston Villa probably joining them, and then probably West Ham rounding out the relegation spots.</p>
<pre class="r"><code>#get predictions for those who would be relegated
relegated  &lt;- predicted_finishes_2020 %&gt;%
  filter(predicted_finish &gt; 17) %&gt;%
  group_by(team) %&gt;%
  summarise(perc = sum(perc)) %&gt;%
  arrange(-perc) %&gt;%
  mutate(prediction = &quot;Relegation chance&quot;)

relegated</code></pre>
<pre><code>## # A tibble: 8 x 3
##   team             perc prediction       
##   &lt;fct&gt;           &lt;dbl&gt; &lt;chr&gt;            
## 1 Norwich City  0.934   Relegation chance
## 2 Aston Villa   0.700   Relegation chance
## 3 Bournemouth   0.507   Relegation chance
## 4 West Ham      0.402   Relegation chance
## 5 Watford       0.270   Relegation chance
## 6 Brighton      0.171   Relegation chance
## 7 Newcastle Utd 0.0126  Relegation chance
## 8 Southampton   0.00270 Relegation chance</code></pre>
</div>
<div id="final-remarks" class="section level2">
<h2>Final Remarks</h2>
<p>I want to make it clear at the end of this post that this probably isn’t the most sophisticated model for predicting football matches (more to come in a part 3, maybe this time within less than a year), but does a pretty good job!</p>
<p>In any case though, I don’t think that running these sims is a good way to end the season- in truth, there’s probably no good way. This post is more about <em>how</em> to use this technique than <em>whether</em> to use it.</p>
<p>Best, stay safe as always!</p>
</div>

      </div>

      


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/football">football</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/models">models</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/rstats">rstats</a>
  
</div>



    </div>
  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/post/advent_calendar_trivia/">Advent Calendar of Football Trivia Analyses</a></li>
    
    <li><a href="/post/dynamic_web_scraping/">Scraping Dynamic Websites with PhantomJS</a></li>
    
    <li><a href="/post/guardian_knowledge_june/">The Guardian Knowledge June 2019</a></li>
    
    <li><a href="/post/dixon_coles_1/">An Introduction to Modelling Soccer Matches in R (part 1)</a></li>
    
    <li><a href="/post/counties_league_points/">Which English County Has Won the Most Points</a></li>
    
  </ul>
</div>




<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

